let db;const request=indexedDB.open("budget",1);function saveRecord(e){db.transaction(["pending"],"readwrite").objectStore("pending").add(e)}function checkDatabase(){const e=db.transaction(["pending"],"readwrite").objectStore("pending").getAll();e.onsuccess=function(){e.result.length>0&&fetch("/api/transaction/bulk",{method:"POST",body:JSON.stringify(e.result),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}}).then(e=>e.json()).then(()=>{db.transaction(["pending"],"readwrite").objectStore("pending").clear()})}}request.onupgradeneeded=function(e){e.target.result.createObjectStore("pending",{autoIncrement:!0})},request.onsuccess=function(e){db=e.target.result,navigator.onLine&&checkDatabase()},request.onerror=function(e){console.log("Woops! "+e.target.errorCode)},window.addEventListener("online",checkDatabase);